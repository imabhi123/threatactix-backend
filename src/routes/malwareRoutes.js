import express from 'express';
import incidentController from '../controllers/malwareController.js';
import { upload } from '../middlewares/multer.middleware.js';

const router = express.Router();

// Move /incidents/search before /incidents/:id
router.get('/malwares/search', incidentController.searchIncidents);
router.post('/malwares-by-id', incidentController.getIncidentsById);

router.post('/malwares', incidentController.createIncident);

router.post('/malwares/create-by-fileupload', upload.single('file'), incidentController.createIncidentByUploadingFile);

router.post('/malwaress/d/getMostAffectedCountries', incidentController.getMostAffectedCountries);
router.post('/malwares/getMostActiveThreatActors', incidentController.getMostActiveThreatActors);
router.post('/malwares/getMostTargetedIndustries', incidentController.getMostTargetedIndustries);

router.get('/malwares', incidentController.getAllIncidents);

// Ensure /incidents/:id comes after /search
router.get('/malwares/:id', incidentController.getIncidentById);
router.put('/malwares/:id', incidentController.updateIncident);
router.delete('/malwares/:id', incidentController.deleteIncident);

router.post('/malwares/dates', incidentController.getIncidentsByDateRange);
router.patch('/malwares/:id/toggle-status', incidentController.updateStatus);
router.post('/malwares/:id/images', incidentController.addImageToIncident);
router.delete('/malwares/:id/images/:imageId', incidentController.removeImageFromIncident);

export default router;
